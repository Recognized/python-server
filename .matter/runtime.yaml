env:
  FAIL_WARMUP: "${FAIL_WARMUP}"
  FAIL_PROCESS: "${FAIL_PROCESS}"
  TIMEOUT: "${TIMEOUT}"
  ERROR_CODE: "${ERROR_CODE}"
before-command: |
  #!/bin/bash
  set -e

  if [ "$FAIL_WARMUP" = "1" ]; then
    exit 1
  fi

  # No dependencies to install - uses built-in Python http.server module
  echo "Preparation complete - no dependencies needed"
preview-port: 38917
service-previews:
  - id: python-server
    title: Python HTTP Server
    description: Starts a simple Python HTTP server
    command: |
      #!/bin/bash
      set -e

      if [ "$FAIL_PROCESS" = "1" ]; then
        exit 1
      fi

      # Start the Python HTTP server on port 38917
      python3 server.py &
      SERVER_PID=$!

      if [ -n "$TIMEOUT" ]; then
        echo "Server will be killed after ${TIMEOUT} seconds"
        sleep "$TIMEOUT" && kill $SERVER_PID 2>/dev/null &
      fi

      wait $SERVER_PID
    preview-port: 38917
